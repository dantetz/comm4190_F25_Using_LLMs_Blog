<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dante">
<meta name="dcterms.date" content="2025-09-27">
<meta name="description" content="Asking Perplexity for First Car Reccomendations">

<title>First Car Reccomendation – My Explorations with LLMs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-0b37c64f34216b628666a8dac638b53b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">My Explorations with LLMs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">First Car Reccomendation</h1>
                  <div>
        <div class="description">
          Asking Perplexity for First Car Reccomendations
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">LLMs</div>
                <div class="quarto-category">Learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Dante </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 27, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="prompt" class="level2">
<h2 class="anchored" data-anchor-id="prompt">Prompt</h2>
<p><span style="color:Blue">What reccomendations would you have for first cars for a high school kid who just got their license.</span></p>
<p>For a high school kid who just got their license, the best first car recommendations focus on safety, reliability, affordability, and ease of driving. Here are some solid options:</p>
<section id="safety-first" class="level3">
<h3 class="anchored" data-anchor-id="safety-first">Safety First</h3>
<ul>
<li>Look for cars with good crash-test ratings and modern safety features like airbags, anti-lock brakes, and stability control.</li>
<li>Avoid high-performance or overly large vehicles that might be harder for new drivers to handle.</li>
</ul>
</section>
<section id="reliability-low-maintenance" class="level3">
<h3 class="anchored" data-anchor-id="reliability-low-maintenance">Reliability &amp; Low Maintenance</h3>
<ul>
<li>Choose brands known for lasting a long time without expensive repairs—Toyota, Honda, Hyundai, and Mazda are often top picks.</li>
<li>Older used cars from these brands can be very cost-effective while still reliable.</li>
</ul>
</section>
<section id="affordability" class="level3">
<h3 class="anchored" data-anchor-id="affordability">Affordability</h3>
<ul>
<li>A used car in good condition around $5,000-$10,000 is often a smart choice for teens.</li>
<li>Economical vehicles that don’t guzzle gas are great for keeping ongoing costs low.</li>
</ul>
</section>
<section id="easy-to-drive-park" class="level3">
<h3 class="anchored" data-anchor-id="easy-to-drive-park">Easy to Drive &amp; Park</h3>
<ul>
<li>Smaller cars or compact SUVs that are easy to maneuver and park help new drivers build confidence.</li>
</ul>
</section>
<section id="specific-models-to-consider" class="level3">
<h3 class="anchored" data-anchor-id="specific-models-to-consider">Specific Models to Consider</h3>
<ul>
<li>Toyota Corolla or Camry (used, reliable, good safety)</li>
<li>Honda Civic or Accord (dependable, affordable maintenance)</li>
<li>Mazda3 or Mazda CX-3 (fun to drive and reliable)</li>
<li>Hyundai Elantra or Sonata (great warranties and value)</li>
<li>Subaru Impreza (all-wheel drive for better handling)</li>
</ul>
</section>
<section id="additional-tips" class="level3">
<h3 class="anchored" data-anchor-id="additional-tips">Additional Tips</h3>
<ul>
<li>Avoid flashy or expensive cars to reduce insurance costs.</li>
<li>Keep the car in good shape and maintain regular service to avoid breakdowns.</li>
<li>Consider safety accessories like backup cameras or parking sensors if possible.</li>
</ul>
<p>Overall, the goal is a car that’s safe, reliable, not too expensive, and easy to drive for a new teen driver. This helps build good driving habits without extra stress or cost.</p>
</section>
</section>
<section id="initial-reflection" class="level2">
<h2 class="anchored" data-anchor-id="initial-reflection">Initial Reflection</h2>
<p><span style="color:green">It was interesting to see that Perplexity had given me criteria to consider without me asking for the criteria itself. I appreciated this and I liked the fact that on top of that, it provided us with specific models as well. Next, I would like to it to provide me with specific models sorted based on the criteria that it had provided before. </span></p>
</section>
<section id="second-prompt" class="level2">
<h2 class="anchored" data-anchor-id="second-prompt">Second Prompt</h2>
<p><span style="color:Blue">Please provide me with a sorted list of the specific car models based on the different criteria that you provided.</span></p>
<p>Here’s a plain list of first car recommendations for a high school kid who just got their license, sorted by the criteria mentioned:</p>
<p><strong>Safety:</strong> - Subaru Impreza (great all-wheel drive and top safety ratings) - Toyota Camry (strong crash-test performance) - Honda Accord (modern safety features) - Hyundai Sonata (good latest safety tech) - Toyota Corolla (reliable safety ratings)</p>
<p><strong>Reliability:</strong> - Toyota Corolla (known for lasting a long time) - Honda Civic (dependable and durable) - Toyota Camry (very reliable midsize sedan) - Mazda3 (reliable and low maintenance) - Hyundai Elantra (backed by good warranties)</p>
<p><strong>Affordability:</strong> - Hyundai Elantra (usually affordable used prices) - Mazda3 (fairly priced on the used market) - Toyota Corolla (affordable purchase and upkeep) - Honda Civic (a bit higher priced but still cost-effective) - Subaru Impreza (often pricier due to AWD feature)</p>
<p><strong>Ease of Driving and Parking:</strong> - Toyota Corolla (compact and easy to maneuver) - Mazda3 (small size with nimble handling) - Hyundai Elantra (compact with smooth drive) - Honda Civic (compact, some sportier versions) - Toyota Camry (larger but generally manageable)</p>
<p>These models are all solid choices for new teen drivers, combining important safety features, ease of handling, and costs that won’t break the bank. Subaru Impreza stands out for safety and traction, Toyota Corolla for overall reliability and ease, while Hyundai and Mazda offer great budget-friendly options.</p>
<p><a href="https://www.prnewswire.com/news-releases/us-news-announces-the-2025-best-cars-for-teens-302466262.html">1</a> <a href="https://www.caranddriver.com/rankings/best-cars-for-teens">2</a> <a href="https://www.iihs.org/ratings/safe-vehicles-for-teens">3</a> <a href="https://www.kbb.com/best-cars/teens/">4</a> <a href="https://kunesgreenfield.com/blog/best-cars-for-teen-drivers-2025-safety-features-and-vehicle-selection-for-new-drivers">5</a> <a href="https://www.lemonade.com/car/explained/20-best-cars-for-teens-in-2025/">6</a> <a href="https://www.youtube.com/watch?v=xbjsmyfNWhQ">7</a> <a href="https://www.iihs.org/news/detail/this-years-teen-vehicle-list-offers-safety-for-every-budget">8</a> <a href="https://cars.usnews.com/cars-trucks/advice/best-cars-for-young-drivers">9</a></p>
</section>
<section id="follow-up" class="level2">
<h2 class="anchored" data-anchor-id="follow-up">Follow Up</h2>
<p><span style="color:Blue">Please include the specific prices under the affordability section and the safety or other applicable ratings for the safety and reliability sections.</span></p>
<p>Here is the updated list of first car recommendations for a high school teen including specific prices and safety/reliability ratings:</p>
<p><strong>Safety:</strong> - <strong>Subaru Impreza:</strong> 2025 model prices average around $25,000 used. Earns strong safety accolades with IIHS Top Safety Pick awards for Subaru models, especially for all-wheel drive and crashworthiness. - <strong>Toyota Camry:</strong> Used 2025 prices near $20,000-$25,000. Consistently receives 5-star NHTSA ratings and “Good” in IIHS crash tests with Toyota Safety Sense technology. - <strong>Honda Accord:</strong> 2025 Honda Civic (similar to Accord) prices typically $22,000-$27,000 used. The Civic Hatchback has IIHS Top Safety Pick+ rating, Civic Sedan a Top Safety Pick. - <strong>Hyundai Sonata:</strong> New models start around $24,000, used pricing varies. Good safety features and 4-5 star NHTSA ratings. - <strong>Toyota Corolla:</strong> Reliable safety with 5-star NHTSA ratings, “Good” in IIHS tests. 2025 used prices average $20,000-$25,000.</p>
<p><strong>Reliability:</strong> - <strong>Toyota Corolla:</strong> Known for durability and long lifespan, top reliability scores from owners and experts. - <strong>Honda Civic:</strong> High marks for reliability and owner satisfaction. - <strong>Toyota Camry:</strong> Very dependable midsize sedan with strong reliability ratings. - <strong>Mazda3:</strong> Above-average reliability with affordable repairs. - <strong>Hyundai Elantra:</strong> Good warranty coverage adds to overall reliability confidence.</p>
<p><strong>Affordability (typical used 2025 price range):</strong> - <strong>Hyundai Elantra:</strong> Starts around $15,000 used. - <strong>Mazda3:</strong> Used prices starting approx. $21,000. - <strong>Toyota Corolla:</strong> Used models typically $20,000-$25,000. - <strong>Honda Civic:</strong> Generally between $22,000 and $27,000. - <strong>Subaru Impreza:</strong> Higher priced at about $25,000 or more due to AWD.</p>
<p><strong>Ease of Driving and Parking:</strong> - Toyota Corolla: Compact size, easy to maneuver and park. - Mazda3: Small, nimble handling makes it easy for new drivers. - Hyundai Elantra: Smooth ride with compact dimensions. - Honda Civic: A bit sportier but still manageable for new drivers. - Toyota Camry: Larger sedan but still generally easy to drive and park.</p>
<p>This detailed info should help find a safe, reliable, affordable, and easy-to-drive first car for a new teen driver.[1][2][3][4][5][6][7][8][9][10][11]</p>
<p><a href="https://www.edmunds.com/used-2025-toyota-corolla-philadelphia-pa/">1</a> <a href="https://www.truecar.com/used-cars-for-sale/listings/toyota/corolla/year-2025/location-philadelphia-pa/">2</a> <a href="https://www.cargurus.com/Cars/l-Used-2025-Honda-Civic-c33542">3</a> <a href="https://www.cargurus.com/Cars/l-Used-2025-Subaru-Impreza-c33793">4</a> <a href="https://www.truecar.com/used-cars-for-sale/listings/mazda/mazda3/year-2025/">5</a> <a href="https://www.truecar.com/used-cars-for-sale/listings/hyundai/elantra/year-2025/">6</a> <a href="https://www.phillipstoyota.com/toyota-corolla-safety-ratings-leesburg-fl.html">7</a> <a href="https://www.youtube.com/watch?v=0TRCGyRU7O8">8</a> <a href="https://media.subaru.com/pressrelease/2294/subaru-earns-three-2025-iihs-top-safety-pick">9</a> <a href="https://www.carcomplaints.com/Toyota/Corolla/2025/safety/">10</a> <a href="https://www.caleyarboroughhonda.com/blog/2025-honda-civic-revolutionary-safety-innovations">11</a> <a href="https://carhelper.com.au/new-car-availability-2025">12</a> <a href="https://www.carfax.com/Used-2025-Toyota-Corolla_z40006">13</a> <a href="https://www.cargurus.com/Cars/l-Used-2025-Toyota-Corolla-c33705">14</a> <a href="https://www.cars.com/shopping/toyota-corolla-2025/philadelphia-pa/">15</a> <a href="https://www.carfax.com/Used-2025-Honda-Civic_z40034">16</a> <a href="https://www.carfax.com/Used-2025-Subaru-Impreza_z40356">17</a> <a href="https://www.kbb.com/mazda/mazda3/">18</a> <a href="https://www.fredbeans.com/models/hyundai-elantra-doylestown-pa.htm">19</a> <a href="https://www.subaru.com/about/company-news/2025-subaru-forester-earns-IIHS-top-safety-pick-award.html">20</a></p>
</section>
<section id="final-reflection" class="level2">
<h2 class="anchored" data-anchor-id="final-reflection">Final Reflection</h2>
<p><span style="color:green"> Perplexity did a good job overall with the list, especially once I asked for the details like actual prices and safety ratings. At first, it gave me a solid general overview but didn’t provide the numbers or ratings upfront, which felt like a missing piece. I had to push a bit to get that kind of concrete info, so it wasn’t fully proactive in delivering everything at once. That said, Perplexity was quick and efficient at adapting when I asked for more specifics — diving into real-time data sources, pulling current used car prices, and referencing reputable safety ratings from IIHS and NHTSA, which was impressive. The inclusion of citations made the info transparent and trustworthy, a big plus compared to other AI tools that often just throw out unchecked facts. Perplexity’s main strength is in combining web search and AI reasoning, so it can find accurate, up-to-date information and organize it well. But it doesn’t fully anticipate every detail users might want right away without some nudging. The conversation feel was pretty natural, and Perplexity stayed on topic, which made the process smooth. </span></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/dantetz\.github\.io\/comm4190_F25_Using_LLMs_Blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>